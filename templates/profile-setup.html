<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lengkapi Profil Anda - Aplikasi Kencan</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/img/favicon.png">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #FF6B6B 0%, #ffffff 50%, #45B7D1 100%);
            min-height: 100vh;
            position: relative;
        }

        .profile-container {
            margin-top: 120px;
            padding: 0 15px;
        }

        .profile-preview-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: sticky;
            top: 140px;
            height: fit-content;
            margin-left: 20px;
        }

        .profile-preview-header {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            padding: 30px 25px 20px;
            text-align: center;
            position: relative;
        }

        .profile-preview-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 5px solid rgba(255, 255, 255, 0.9);
            object-fit: cover;
            margin: 0 auto 15px;
            display: block;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 3rem;
        }

        .profile-preview-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-preview-name {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        .profile-preview-age {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            margin: 5px 0 0;
        }

        .profile-preview-body {
            padding: 25px;
        }

        .profile-info-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 107, 107, 0.05);
            border-radius: 12px;
            border-left: 4px solid #FF6B6B;
        }

        .profile-info-item i {
            width: 20px;
            color: #FF6B6B;
            margin-right: 12px;
            font-size: 1rem;
        }

        .profile-info-item span {
            color: #495057;
            font-weight: 500;
        }

        .profile-bio {
            background: rgba(78, 205, 196, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid #4ECDC4;
        }

        .profile-bio h6 {
            color: #4ECDC4;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .profile-bio h6 i {
            margin-right: 8px;
        }

        .profile-bio p {
            color: #6c757d;
            margin: 0;
            line-height: 1.5;
            font-style: italic;
        }

        .main-content-wrapper {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            max-width: 1400px;
            margin: 0 auto;
        }

        .profile-form-wrapper {
            flex: 3.5;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin-right: 20px;
        }

        .profile-preview-wrapper {
            flex: 1;
            flex-shrink: 0;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .section-title {
            color: #495057;
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 107, 107, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 8px;
        }

        .form-control {
            border: 2px solid rgba(255, 107, 107, 0.2);
            border-radius: 10px;
            padding: 12px 15px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: #FF6B6B;
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.25);
        }
        
        /* Validation styles */
        .invalid-feedback {
            display: none;
            width: 100%;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #dc3545;
            font-weight: 500;
            background-color: rgba(220, 53, 69, 0.1);
            padding: 0.5rem;
            border-radius: 0.375rem;
            border-left: 3px solid #dc3545;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .was-validated .form-control:invalid,
        .form-control.is-invalid,
        .was-validated .form-select:invalid,
        .form-select.is-invalid {
            border-color: #dc3545;
            padding-right: calc(1.5em + 0.75rem);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right calc(0.375em + 0.1875rem) center;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
        }
        
        .was-validated .form-control:invalid:focus,
        .form-control.is-invalid:focus,
        .was-validated .form-select:invalid:focus,
        .form-select.is-invalid:focus {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
        }
        
        /* Radio and checkbox validation */
        .radio-group.is-invalid {
            border-left: 3px solid #dc3545;
            padding-left: 10px;
            background-color: rgba(220, 53, 69, 0.05);
            border-radius: 0.375rem;
        }
        
        /* Make error messages more visible */
        .invalid-feedback.d-block,
        .invalid-feedback[style*="display: block"] {
            display: block !important;
            margin-bottom: 10px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: #FF6B6B;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            border: none;
            border-radius: 25px;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.4);
        }

        .photo-preview {
            margin-top: 15px;
            text-align: center;
        }

        .photo-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            object-fit: cover;
            border: 3px solid #FF6B6B;
        }

        .remove-photo-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            margin-top: 10px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .remove-photo-btn:hover {
            background: #c82333;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .checkbox-item:hover {
            border-color: #FF6B6B;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #FF6B6B;
        }
        
        .range-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .range-input {
            flex: 1;
        }
        
        .range-value {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: #FF6B6B;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .radio-item input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: #FF6B6B;
        }

        @media (max-width: 992px) {
            .main-content-wrapper {
                flex-direction: column;
                padding: 0 10px;
            }
            
            .profile-preview-wrapper {
                width: 100%;
                order: -1;
            }
            
            .profile-preview-card {
                position: relative;
                top: auto;
                margin-left: 0;
            }

            .profile-form-wrapper {
                margin-right: 0;
                padding: 25px;
            }

            .profile-container {
                padding: 0 10px;
            }
        }

        @media (max-width: 768px) {
            .form-section {
                padding: 20px;
            }

            .profile-form-wrapper {
                padding: 20px;
            }

            .section-title {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    {% set active_page = 'profile_setup' %}
    {% include 'navbar_logged_in.html' %}

    <div class="profile-container">
        <div class="container">
            <div class="main-content-wrapper">
                <!-- Profile Preview Card -->
                <div class="profile-preview-wrapper">
                    <div class="profile-preview-card">
                        <div class="profile-preview-header">
                            <div class="profile-preview-avatar" id="previewAvatar">
                                {% if profile_data and profile_data.photo_url %}
                                    <img src="{{ profile_data.photo_url }}" alt="Foto Profil">
                                {% else %}
                                    <i class="fas fa-user"></i>
                                {% endif %}
                            </div>
                            <h3 class="profile-preview-name" id="previewName">{{ profile_data.first_name if profile_data else 'Nama Anda' }} {{ profile_data.last_name if profile_data else '' }}</h3>
                            <p class="profile-preview-age" id="previewAge">{{ profile_data.age if profile_data else 'Usia' }} tahun</p>
                        </div>
                        <div class="profile-preview-body">
                            <div class="profile-info-item" id="previewGender">
                                <i class="fas fa-venus-mars"></i>
                                <span>{{ 'Laki-laki' if profile_data and profile_data.gender == 'male' else 'Perempuan' if profile_data and profile_data.gender == 'female' else 'Jenis Kelamin' }}</span>
                            </div>
                            <div class="profile-info-item" id="previewLocation">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>{{ profile_data.location if profile_data else 'Lokasi' }}</span>
                            </div>
                            <div class="profile-info-item" id="previewHeight">
                                <i class="fas fa-ruler-vertical"></i>
                                <span>{{ profile_data.height_cm if profile_data and profile_data.height_cm else 'Tinggi' }} cm</span>
                            </div>
                            <div class="profile-info-item" id="previewWeight">
                                <i class="fas fa-weight"></i>
                                <span>{{ profile_data.weight_kg if profile_data and profile_data.weight_kg else 'Berat' }} kg</span>
                            </div>
                            <div class="profile-info-item" id="previewEducation">
                                <i class="fas fa-graduation-cap"></i>
                                <span>{{ profile_data.education if profile_data else 'Pendidikan' }}</span>
                            </div>
                            <div class="profile-info-item" id="previewReligion">
                                <i class="fas fa-pray"></i>
                                <span>{{ profile_data.religion if profile_data else 'Agama' }}</span>
                            </div>
                            <div class="profile-info-item" id="previewSmoking">
                                <i class="fas fa-smoking"></i>
                                <span>{{ 'Ya' if profile_data and profile_data.smoking else 'Tidak' if profile_data and profile_data.smoking == False else 'Merokok' }}</span>
                            </div>
                            <div class="profile-info-item" id="previewSocialCare">
                                <i class="fas fa-hands-helping"></i>
                                <span>Kepedulian Sosial: {{ preferences_similarity.care_social_issues if preferences_similarity and preferences_similarity.care_social_issues else '3' }}/5</span>
                            </div>
                            <div class="profile-info-item" id="previewPets">
                                <i class="fas fa-paw"></i>
                                <span>{{ 'Ya' if preferences_similarity and preferences_similarity.has_pets else 'Tidak' if preferences_similarity and preferences_similarity.has_pets == False else 'Memiliki Hewan Peliharaan' }}</span>
                            </div>
                            <div class="profile-info-item" id="previewContact" style="display: none;">
                                <i class="fab fa-whatsapp"></i>
                                <a href="#" target="_blank" rel="noopener noreferrer">
                                    <span></span>
                                </a>
                            </div>
                            <div class="profile-info-item" id="previewInstagram" style="display: none;">
                                <i class="fab fa-instagram"></i>
                                <a href="#" target="_blank" rel="noopener noreferrer">
                                    <span></span>
                                </a>
                            </div> 
                            <div class="profile-bio" id="previewBio" style="display: none;">
                                <h6><i class="fas fa-quote-left"></i>Tentang Saya</h6>
                                <p>{{ profile_data.hobbies if profile_data else '' }}</p>
                            </div>                       
                        </div>
                    </div>
                </div>

                <!-- Profile Form -->
                <div class="profile-form-wrapper">
                    <h2>Lengkapi Profil Anda</h2>
                    <p>Mari berkenalan lebih dekat untuk menemukan pasangan yang sempurna untuk Anda!</p>
                    
            <form id="profileSetupForm" class="profile-form" action="{{ url_for('profile_setup') }}" method="POST" enctype="multipart/form-data">
            <!-- Basic Information -->
            <div class="form-section">
                <h3 class="section-title"><i class="fas fa-user me-2"></i>Informasi Dasar</h3>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="firstName" class="form-label">Nama Depan</label>
                            <input type="text" id="firstName" name="first_name" class="form-control" placeholder="Masukkan nama depan Anda" value="{{ profile_data.first_name if profile_data else '' }}" required>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="lastName" class="form-label">Nama Belakang</label>
                            <input type="text" id="lastName" name="last_name" class="form-control" placeholder="Masukkan nama belakang Anda" value="{{ profile_data.last_name if profile_data else '' }}" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="profilePhoto" class="form-label">Foto Profil</label>
                    <input type="file" id="profilePhoto" name="profile_photo" class="form-control" accept="image/*" {% if not profile_data or not profile_data.photo_url %}required{% endif %}>
                    <input type="hidden" id="remove_photo" name="remove_photo" value="false">
                    {% if profile_data and profile_data.photo_url %}
                        <div class="photo-preview">
                            <img src="{{ url_for('static', filename='uploads/' + profile_data.photo_url) }}" alt="Current photo">
                            <br>
                            <button type="button" class="remove-photo-btn" onclick="removePhoto()">Hapus Foto</button>
                        </div>
                    {% endif %}
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="dateOfBirth" class="form-label">Tanggal Lahir</label>
                            <input type="date" id="dateOfBirth" name="date_of_birth" class="form-control" value="{{ profile_data.date_of_birth.strftime('%Y-%m-%d') if profile_data and profile_data.date_of_birth else '' }}" required>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Jenis Kelamin</label>
                            <select id="gender" name="gender" class="form-control" required>
                                <option value="">Pilih Jenis Kelamin</option>
                                <option value="male" {{ 'selected' if profile_data and profile_data.gender == 'male' else '' }}>Laki-laki</option>
                                <option value="female" {{ 'selected' if profile_data and profile_data.gender == 'female' else '' }}>Perempuan</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="provinsi" class="form-label">Provinsi <span class="required">*</span></label>
                            <select id="provinsi" name="provinsi" class="form-control">
                                <option value="">Pilih Provinsi</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="kabupaten" class="form-label">Kabupaten/Kota <span class="required">*</span></label>
                            <select id="kabupaten" name="kabupaten" class="form-control" disabled>
                                <option value="">Pilih Kabupaten/Kota</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <input type="hidden" id="location" name="location" value="{{ profile_data.location if profile_data else '' }}">
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="weight_kg" class="form-label">Berat Badan (kg)</label>
                            <input type="number" id="weight_kg" name="weight_kg" class="form-control" min="30" max="200" placeholder="Berat badan" value="{{ profile_data.weight_kg if profile_data and profile_data.weight_kg else '' }}">
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="height_cm" class="form-label">Tinggi Badan (cm)</label>
                            <input type="number" id="height_cm" name="height_cm" class="form-control" min="100" max="250" placeholder="Tinggi badan" value="{{ profile_data.height_cm if profile_data and profile_data.height_cm else '' }}">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Relationship Goals -->
            <div class="form-section">
                <h3 class="section-title"><i class="fas fa-heart me-2"></i>Tujuan Hubungan</h3>
                
                <div class="form-group">
                    <label class="form-label">Tujuan Hubungan <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="casual" name="relationship_goal" value="casual" {{ 'checked' if profile_data and profile_data.relationship_goal == 'casual' else '' }} required>
                            <label for="casual">Kasual</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="serious" name="relationship_goal" value="serious" {{ 'checked' if profile_data and profile_data.relationship_goal == 'serious' else '' }} required>
                            <label for="serious">Serius</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Lifestyle -->
            <div class="form-section">
                <h3 class="section-title"><i class="fas fa-leaf me-2"></i>Gaya Hidup</h3>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Kebiasaan Merokok</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="smoking_yes" name="smoking" value="yes" {{ 'checked' if profile_data and profile_data.smoking else '' }}>
                                    <label for="smoking_yes">Ya</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="smoking_no" name="smoking" value="no" {{ 'checked' if profile_data and profile_data.smoking == False else '' }}>
                                    <label for="smoking_no">Tidak</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Kebiasaan Alkohol</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="alcohol_yes" name="alcohol" value="yes" {{ 'checked' if profile_data and profile_data.alcohol else '' }}>
                                    <label for="alcohol_yes">Ya</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="alcohol_no" name="alcohol" value="no" {{ 'checked' if profile_data and profile_data.alcohol == False else '' }}>
                                    <label for="alcohol_no">Tidak</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Personal Information -->
            <div class="form-section">
                <h3 class="section-title"><i class="fas fa-info-circle me-2"></i>Informasi Personal</h3>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="religion" class="form-label">Agama</label>
                            <select id="religion" name="religion" class="form-control" required>
                                <option value="">Pilih Agama</option>
                                <option value="islam" {{ 'selected' if profile_data and profile_data.religion == 'islam' else '' }}>Islam</option>
                                <option value="kristen_protestan" {{ 'selected' if profile_data and profile_data.religion == 'kristen_protestan' else '' }}>Kristen Protestan</option>
                                <option value="kristen_katolik" {{ 'selected' if profile_data and profile_data.religion == 'kristen_katolik' else '' }}>Kristen Katolik</option>
                                <option value="hindu" {{ 'selected' if profile_data and profile_data.religion == 'hindu' else '' }}>Hindu</option>
                                <option value="buddha" {{ 'selected' if profile_data and profile_data.religion == 'buddha' else '' }}>Buddha</option>
                                <option value="konghucu" {{ 'selected' if profile_data and profile_data.religion == 'konghucu' else '' }}>Konghucu</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="education" class="form-label">Pendidikan Terakhir</label>
                            <select id="education" name="education" class="form-control">
                                <option value="">Pilih pendidikan</option>
                                <option value="SMA" {{ 'selected' if profile_data and profile_data.education == 'SMA' else '' }}>SMA/SMK</option>
                                <option value="D3" {{ 'selected' if profile_data and profile_data.education == 'D3' else '' }}>Diploma (D3)</option>
                                <option value="S1" {{ 'selected' if profile_data and profile_data.education == 'S1' else '' }}>Sarjana (S1)</option>
                                <option value="S2" {{ 'selected' if profile_data and profile_data.education == 'S2' else '' }}>Magister (S2)</option>
                                <option value="S3" {{ 'selected' if profile_data and profile_data.education == 'S3' else '' }}>Doktor (S3)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="hobbies" class="form-label">Hobi</label>
                    <textarea id="hobbies" name="hobbies" class="form-control" rows="3" placeholder="Ceritakan hobi dan minat Anda...">{{ profile_data.hobbies if profile_data else '' }}</textarea>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="whatsapp" class="form-label">WhatsApp</label>
                            <input type="text" id="whatsapp" name="whatsapp" class="form-control" 
                                   placeholder="Nomor WhatsApp (diawali dengan 62)" 
                                   pattern="^62\d+" 
                                   title="Nomor WhatsApp harus diawali dengan 62 (tanpa tanda + atau 0)" 
                                   value="{{ profile_data.whatsapp if profile_data else '' }}">
                            <small class="form-text text-muted">Contoh: 628123456789</small>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="instagram" class="form-label">Instagram</label>
                            <input type="text" id="instagram" name="instagram" class="form-control" placeholder="Username Instagram" value="{{ profile_data.instagram if profile_data else '' }}">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Preferences Scale -->
            <div class="form-section">
                <h3 class="section-title"><i class="fas fa-chart-bar me-2"></i>Preferensi Personal</h3>
                
                <div class="form-group">
                    <label for="care_social_issues" class="form-label">Kepedulian Sosial (1-5)</label>
                    <div class="range-group">
                        <input type="range" id="care_social_issues" name="care_social_issues" class="form-range range-input" min="1" max="5" value="{{ preferences_similarity.care_social_issues if preferences_similarity and preferences_similarity.care_social_issues else '3' }}" oninput="updateRangeValue('care_social_issues')">
                        <span id="care_social_issues_value" class="range-value">3</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="sports_frequency" class="form-label">Frekuensi Olahraga (1-5)</label>
                    <div class="range-group">
                        <input type="range" id="sports_frequency" name="sports_frequency" class="form-range range-input" min="1" max="5" value="{{ preferences_similarity.sports_frequency if preferences_similarity and preferences_similarity.sports_frequency else '3' }}" oninput="updateRangeValue('sports_frequency')">
                        <span id="sports_frequency_value" class="range-value">3</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Memiliki Peliharaan</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="has_pets_yes" name="has_pets" value="yes" {{ 'checked' if preferences_similarity and preferences_similarity.has_pets else '' }}>
                            <label for="has_pets_yes">Ya</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="has_pets_no" name="has_pets" value="no" {{ 'checked' if preferences_similarity and preferences_similarity.has_pets == False else '' }}>
                            <label for="has_pets_no">Tidak</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="outdoor_activity" class="form-label">Aktivitas Outdoor (1-5)</label>
                    <div class="range-group">
                        <input type="range" id="outdoor_activity" name="outdoor_activity" class="form-range range-input" min="1" max="5" value="{{ preferences_similarity.outdoor_activity if preferences_similarity and preferences_similarity.outdoor_activity else '3' }}" oninput="updateRangeValue('outdoor_activity')">
                        <span id="outdoor_activity_value" class="range-value">3</span>
                    </div>
                    <small class="form-text text-muted">1 = Jarang, 5 = Sangat Sering</small>
                </div>
            </div>
            
            <!-- Language and Time -->
            <div class="form-section">
                <h3 class="section-title"><i class="fas fa-clock me-2"></i>Bahasa & Waktu Aktif</h3>
                
                <div class="form-group">
                    <label class="form-label">Bahasa yang Digunakan</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="lang_id" name="language_used" value="Indonesian" {{ 'checked' if profile_data and profile_data.language_used and 'Indonesian' in profile_data.language_used else '' }}>
                            <label for="lang_id">Bahasa Indonesia</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="lang_en" name="language_used" value="English" {{ 'checked' if profile_data and profile_data.language_used and 'English' in profile_data.language_used else '' }}>
                            <label for="lang_en">English</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="lang_jv" name="language_used" value="Javanese" {{ 'checked' if profile_data and profile_data.language_used and 'Javanese' in profile_data.language_used else '' }}>
                            <label for="lang_jv">Bahasa Jawa</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="lang_sd" name="language_used" value="Sundanese" {{ 'checked' if profile_data and profile_data.language_used and 'Sundanese' in profile_data.language_used else '' }}>
                            <label for="lang_sd">Bahasa Sunda</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Waktu Aktif</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="time_morning" name="active_time" value="1" {{ 'checked' if preferences_similarity and preferences_similarity.active_time and '1' in preferences_similarity.active_time else '' }}>
                            <label for="time_morning">Pagi (06:00-12:00)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="time_afternoon" name="active_time" value="2" {{ 'checked' if preferences_similarity and preferences_similarity.active_time and '2' in preferences_similarity.active_time else '' }}>
                            <label for="time_afternoon">Siang (12:00-18:00)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="time_evening" name="active_time" value="3" {{ 'checked' if preferences_similarity and preferences_similarity.active_time and '3' in preferences_similarity.active_time else '' }}>
                            <label for="time_evening">Sore (18:00-21:00)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="time_night" name="active_time" value="4" {{ 'checked' if preferences_similarity and preferences_similarity.active_time and '4' in preferences_similarity.active_time else '' }}>
                            <label for="time_night">Malam (21:00-06:00)</label>
                        </div>
                    </div>
                </div>
            </div>
            
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Simpan Profile
                    </button>
                </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Wilayah Local Handler -->
    <script src="{{ url_for('static', filename='js/wilayah-local.js') }}"></script>
    
    <!-- Location Prefill Handler -->
    <script src="{{ url_for('static', filename='js/location-prefill.js') }}"></script>
    
    <!-- Profile Prefill Handler -->
    <script src="{{ url_for('static', filename='js/profile-prefill.js') }}"></script>

    <script src="{{ url_for('static', filename='js/profile-setup.js') }}"></script>
    
    <script>
        // Range input handler
        function updateRangeValue(fieldName) {
            const range = document.getElementById(fieldName);
            const valueSpan = document.getElementById(fieldName + '_value');
            valueSpan.textContent = range.value;
            updatePreview();
        }
        
        // Photo preview handler
        document.getElementById('profilePhoto').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const previewAvatar = document.getElementById('previewAvatar');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewAvatar.innerHTML = `<img src="${e.target.result}" alt="Foto Profil">`;
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Remove photo function
        function removePhoto() {
            document.getElementById('profilePhoto').value = '';
            document.getElementById('previewAvatar').innerHTML = '<i class="fas fa-user"></i>';
            document.getElementById('remove_photo').value = 'true';
            const photoPreview = document.querySelector('.photo-preview');
            if (photoPreview) {
                photoPreview.style.display = 'none';
            }
        }
        
        // Real-time preview update
        function updatePreview() {
            // Update name
            const firstName = document.getElementById('firstName').value || 'Nama';
            const lastName = document.getElementById('lastName').value || '';
            document.getElementById('previewName').textContent = `${firstName} ${lastName}`.trim();
            
            // Calculate and update age from date of birth
            const dateOfBirth = document.getElementById('dateOfBirth').value;
            if (dateOfBirth) {
                const today = new Date();
                const birthDate = new Date(dateOfBirth);
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                document.getElementById('previewAge').textContent = `${age} tahun`;
            }
            
            // Update gender
            const gender = document.getElementById('gender').value;
            const genderText = gender === 'male' ? 'Laki-laki' : gender === 'female' ? 'Perempuan' : 'Jenis Kelamin';
            document.querySelector('#previewGender span').textContent = genderText;
            
            // Update location
            const provinsi = document.getElementById('provinsi');
            const kabupaten = document.getElementById('kabupaten');
            let location = 'Lokasi';
            if (kabupaten && kabupaten.value && provinsi && provinsi.value) {
                const provinsiText = provinsi.options[provinsi.selectedIndex].text;
                const kabupatenText = kabupaten.options[kabupaten.selectedIndex].text;
                location = `${kabupatenText}, ${provinsiText}`;
            } else if (provinsi && provinsi.value) {
                location = provinsi.options[provinsi.selectedIndex].text;
            }
            document.querySelector('#previewLocation span').textContent = location;
            
            // Update height
            const height = document.getElementById('height_cm').value;
            document.querySelector('#previewHeight span').textContent = height ? `${height} cm` : 'Tinggi';
            
            // Update weight
            const weight = document.getElementById('weight_kg').value;
            document.querySelector('#previewWeight span').textContent = weight ? `${weight} kg` : 'Berat';
            
            // Update education
            const education = document.getElementById('education').value;
            document.querySelector('#previewEducation span').textContent = education || 'Pendidikan';
            
            // Update religion
            const religion = document.getElementById('religion').value;
            const religionText = {
                'islam': 'Islam',
                'kristen_protestan': 'Kristen Protestan',
                'kristen_katolik': 'Kristen Katolik',
                'hindu': 'Hindu',
                'buddha': 'Buddha',
                'konghucu': 'Konghucu'
            };
            document.querySelector('#previewReligion span').textContent = religion ? religionText[religion] : 'Agama';
            
            // Update smoking
            const smoking = document.querySelector('input[name="smoking"]:checked');
            const smokingText = smoking ? (smoking.value === 'yes' ? 'Ya' : 'Tidak') : 'Merokok';
            document.querySelector('#previewSmoking span').textContent = smokingText;
            
            // Update social care
            const socialCare = document.getElementById('care_social_issues').value;
            document.querySelector('#previewSocialCare span').textContent = `Kepedulian Sosial: ${socialCare || '3'}/5`;
            
            // Update pets
            const pets = document.querySelector('input[name="has_pets"]:checked');
            const petsText = pets ? (pets.value === 'yes' ? 'Ya' : 'Tidak') : 'Memiliki Hewan Peliharaan';
            document.querySelector('#previewPets span').textContent = petsText;
            
            // Update WhatsApp
            const whatsapp = document.getElementById('whatsapp').value;
            const previewContact = document.getElementById('previewContact');
            if (whatsapp) {
                // Validasi format nomor WhatsApp
                const formattedWhatsapp = whatsapp.startsWith('62') ? whatsapp : `62${whatsapp.replace(/^0+/, '')}`;
                
                previewContact.style.display = 'flex';
                const link = previewContact.querySelector('a');
                link.href = `https://wa.me/${formattedWhatsapp.replace(/[^0-9]/g, '')}`;
                link.querySelector('span').textContent = formattedWhatsapp;
            } else {
                previewContact.style.display = 'none';
            }
            
            // Update Instagram
            const instagram = document.getElementById('instagram').value;
            const previewInstagram = document.getElementById('previewInstagram');
            if (instagram) {
                previewInstagram.style.display = 'flex';
                const link = previewInstagram.querySelector('a');
                link.href = `https://instagram.com/${instagram.replace('@', '')}`;
                link.querySelector('span').textContent = `@${instagram.replace('@', '')}`;
            } else {
                previewInstagram.style.display = 'none';
            }
            
            // Update bio/hobbies
            const hobbies = document.getElementById('hobbies').value;
            const previewBio = document.getElementById('previewBio');
            if (hobbies) {
                previewBio.style.display = 'block';
                previewBio.querySelector('p').textContent = hobbies;
            } else {
                previewBio.style.display = 'none';
            }
        }
        
        // Initialize form on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Profile setup page loaded');
            
            // Initialize range values
            updateRangeValue('care_social_issues');
            updateRangeValue('sports_frequency');
            
            // Add event listeners for real-time updates
            const inputs = ['firstName', 'lastName', 'dateOfBirth', 'gender', 'height_cm', 'weight_kg', 'education', 'religion', 'hobbies', 'whatsapp', 'instagram'];
            
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updatePreview);
                    element.addEventListener('change', updatePreview);
                }
            });
            
            // Add listeners for radio buttons
            document.querySelectorAll('input[name="smoking"], input[name="has_pets"]').forEach(radio => {
                radio.addEventListener('change', updatePreview);
            });
            
            // Add listeners for select elements
            const provinsi = document.getElementById('provinsi');
            const kabupaten = document.getElementById('kabupaten');
            if (provinsi) provinsi.addEventListener('change', updatePreview);
            if (kabupaten) kabupaten.addEventListener('change', updatePreview);
            
            // Initialize wilayah form handler
            try {
                const wilayahHandler = new WilayahLocalHandler({
                    provinsiSelectId: 'provinsi',
                    kabupatenSelectId: 'kabupaten',
                    locationHiddenId: 'location'
                });
                console.log('Wilayah local handler initialized');
            } catch (error) {
                console.error('Error initializing wilayah handler:', error);
            }
            
            // Form validation
            const form = document.querySelector('.profile-form');
            if (form) {
                console.log('Form found, adding validation');
                form.addEventListener('submit', function(e) {
                    const provinsi = document.getElementById('provinsi');
                    const kabupaten = document.getElementById('kabupaten');
                    const location = document.getElementById('location');
                    const whatsapp = document.getElementById('whatsapp');
                    
                    // Validasi nomor WhatsApp harus diawali dengan 62
                    if (whatsapp.value && !whatsapp.value.startsWith('62')) {
                        e.preventDefault();
                        showMessage('Nomor WhatsApp harus diawali dengan 62 (tanpa tanda + atau 0)', 'error');
                        whatsapp.focus();
                        return false;
                    }
                    
                    if (!provinsi.value || !kabupaten.value) {
                        e.preventDefault();
                        showMessage('Silakan pilih provinsi dan kabupaten/kota', 'error');
                        return false;
                    }
                    
                    // Ensure location field is updated
                    if (!location.value) {
                        const provinsiText = provinsi.options[provinsi.selectedIndex].text;
                        const kabupatenText = kabupaten.options[kabupaten.selectedIndex].getAttribute('data-name') || 
                                            kabupaten.options[kabupaten.selectedIndex].text;
                        location.value = `${kabupatenText}, ${provinsiText}`;
                    }
                    
                    console.log('Form submitted with location:', location.value);
                    
                    // Show loading state
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Menyimpan...';
                        submitBtn.disabled = true;
                    }
                    
                    // Show success message after a short delay to simulate processing
                    setTimeout(function() {
                        showMessage('✅ Profil berhasil disimpan!', 'success');
                    }, 500);
                });
            } else {
                console.error('Form not found!');
            }
            
            // Initial preview update
            updatePreview();
            
            // Check if all required elements are present
            const requiredElements = ['firstName', 'lastName', 'profilePhoto', 'gender', 'dateOfBirth', 'provinsi', 'kabupaten'];
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                if (!element) {
                    console.error(`Required element not found: ${id}`);
                } else {
                    console.log(`Element found: ${id}`);
                }
            });
        });
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>